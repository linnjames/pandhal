<?xml version="1.0" encoding="utf-8" ?>
<odoo>

  <record id="support_center_view_form" model="ir.ui.view">
    <field name="name">Support Center Form View</field>
    <field name="model">support.center</field>
    <field name="arch" type="xml">
      <form string="Support Center Form View">
        <header>
          <button name="button_received" string="Received" states="draft" class="oe_highlight" type="object"/>
          <button name="button_in_progress" string="Work Started" states="received,on_hold" class="oe_highlight" type="object"/>
          <button name="button_delivered" string="Delivered" states="in_progress,rescheduled" class="oe_highlight" type="object"/>
          <button name="button_reschedule" string="Reschedule" states="in_progress,on_hold" class="oe_highlight" type="object"/>
          <button name="button_on_hold" string="Hold Ticket" states="in_progress,rescheduled" class="oe_highlight" type="object"/>
          <button name="button_completed" string="Completed" states="delivered" class="oe_highlight" type="object" />
          <button name="create_invoice" string="Create Invoice" type="object"
                  attrs="{'invisible': ['|',('product_line_ids', '=', False),('invoice_id','!=',False)]}"/>
          <field name="state" widget="statusbar" statusbar_visible="draft,received,in_progress,delivered,completed"/>
        </header>
        <sheet>
          <div class="oe_title">
            <label for="name" class="oe_edit_only" string="Ticket"/>
            <h3>
              <field name="sl_no" readonly="1"/>
            </h3>
            <h1>
              <field name="name" placeholder="Ticket Name" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
            </h1>
          </div>
          <group>
            <group>
              <field name="attended_user_id" required="1" attrs="{'readonly': [('state', '!=', 'draft')]}" options="{'no_create': True}"/>
              <field name="assigned_user_id" required="1" options="{'no_create': True}" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
            </group>
            <group>
               <field name="customer_id"
                      attrs="{'readonly': [('state', '!=', 'draft')]}"
                      domain = "[('is_company', '=', True)]"
                      context="{'default_is_company': True}"/>
              <field name="customer_contact_id"
                     attrs="{'readonly': [('state', '!=', 'draft')]}"
                     domain="[('parent_id', '=', customer_id)]" options="{'no_create': True}"/>
            </group>
          </group>
          <group>
            <group>
              <field name="service_type" attrs="{'readonly':[('state','!=','draft')]}" required="1"/>
              <field name="case_type" widget="selection" attrs="{'readonly':[('state','!=','draft')]}"/>
              <field name="priority" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
              <field name="total_working_time" attrs="{'invisible':[('total_working_time', '=', False)]}"/>
              <field name="location_id"
                     attrs="{'readonly':[('state','in',['delivered','completed'])]}"/>
             <field name="invoice_id" attrs="{'invisible':[('invoice_id','=',False)]}"/>
            </group>
            <group>
              <field name="date_received" attrs="{'readonly':[('state','!=','draft')]}"/>
              <field name="date_scheduled" attrs="{'readonly': [('state', '!=', 'draft')],'required':1}"/>
              <field name="expected_working_hour" string="Expected Work Hour" attrs="{'readonly': [('state', '!=', 'draft')],'required':1}"/>
              <field name="work_started_time" string="Work Started Time" attrs="{'invisible':[('work_started_time', '=', False)]}"/>
              <field name="date_rescheduled" attrs="{'readonly':[('state','!=','draft')],'invisible':[('date_rescheduled','=',False)]}"/>
              <field name="date_delivered"
                     readonly="True"
                     attrs="{'invisible':[('date_delivered','=',False)]}"/>
              <field name="date_completed"
                     readonly="True"
                     attrs="{'invisible': [('date_completed','=',False)]}"/>
            </group>
          </group>
          <notebook>
            <page name="issue_description" string="Issue Description">
              <field name="issue_description" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
            </page>
             <page name="solution_description" string="Solution Delivered">
              <field name="solution_description" attrs="{'readonly': [('state', '=', 'completed')]}"/>
            </page>
            <page name="products_used" string="Products Used">
              <field name="product_line_ids"
                     attrs="{'readonly':[('state','in',['delivered','completed'])]}">
                <tree editable="bottom">
                  <field name="product_id"/>
                  <field name="product_uom_category_id"/>
                  <field name="product_uom_id"/>
                  <field name="quantity"/>
                  <field name="name"/>
                </tree>
              </field>
            </page>
            <page name="internal_notes" string="Internal Notes">
              <field name="internal_notes" attrs="{'readonly': [('state', '=', 'completed')]}"/>
            </page>
          </notebook>
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids"/>
          <field name="activity_ids"/>
          <field name="message_ids"/>
        </div>
      </form>
    </field>
  </record>

  <record id="support_center_view_tree" model="ir.ui.view">
    <field name="name">Support Center Tree View</field>
    <field name="model">support.center</field>
    <field name="arch" type="xml">
      <tree string="Support Center Tree View">
        <field name="sl_no"/>
        <field name="name"/>
        <field name="date_received"/>
        <field name="customer_contact_id"/>
        <field name="assigned_user_id"/>
        <field name="priority" />
        <field name="date_scheduled"/>
        <field name="state"/>
      </tree>
    </field>
  </record>


  <record id="support_center_view_search" model="ir.ui.view">
    <field name="name">Support Center Search View</field>
    <field name="model">support.center</field>
    <field name="arch" type="xml">
      <search string="Support Center Search View">
        <field name="sl_no" string="Sl No"/>
        <field name="name" string="Description"/>
        <field name="customer_contact_id" string="Customer"/>
        <filter string="My Tickets"
                name="assigned_tickets"
                domain="[('assigned_user_id', '=', uid)]"/>
        <separator/>
        <filter string="Draft"
                name="draft_records"
                domain="[('state','=','draft')]"/>
        <filter string="Received"
                name="received_records"
                domain="[('state','=','received')]"/>
        <filter string="In_progress"
                name="in_progress_records"
                domain="[('state','=','in_progress')]"/>
        <filter string="On_hold"
                name="on_hold_records"
                domain="[('state','=','on_hold')]"/>
        <filter string="Completed"
                name="completed_records"
                domain="[('state','=','completed')]"/>
        <separator/>
        <filter string="High Priority"
                name="high_priority"
                domain="[('priority','=','high')]"/>
        <filter string="Medium Priority"
                name="medium_priority"
                domain="[('priority','=','medium')]"/>
        <filter string="Low Priority"
                name="low_priority"
                domain="[('priority','=','low')]"/>
        <group expand="0" string="Group By">
          <filter string="State" name="group_by_state" domain="[]" context="{'group_by': 'state'}"/>
          <filter string="Priority" name="group_by_priority" domain="[]" context="{'group_by': 'priority'}"/>
          <filter string="Assigned To" name="group_by_assigned" domain="[]" context="{'group_by': 'assigned_user_id'}"/>
          <filter string="Attended By" name="group_by_attended" domain="[]" context="{'group_by': 'attended_user_id'}"/>
        </group>
      </search>
    </field>
  </record>

  <record id="action_support_center" model="ir.actions.act_window">
    <field name="name">Tickets</field>
    <field name="res_model">support.center</field>
    <field name="type">ir.actions.act_window</field>
    <field name="view_mode">tree,kanban,form</field>
    <field name="context">{
      'search_default_assigned_tickets': True,
      'search_default_group_by_priority': True,
      'search_default_received_records': True,
      'search_default_in_progress_records': True,
      'search_default_on_hold_records': True
      }</field>
  </record>
  <menuitem id="menu_support_main"
            name="Centrum"
            groups="support_group_user"
            web_icon="catalist_support,static/description/icon.png"/>
  <menuitem id="menu_support_sub"
            name="Centrum"
            parent="menu_support_main"
            groups="support_group_user"/>
  <menuitem id="menu_support_center"
            name="Tickets"
            parent="menu_support_sub"
            action="action_support_center"
            sequence="10"
            groups="support_group_user"/>


  <record id="action_res_partner_cat" model="ir.actions.act_window">
    <field name="name">Contacts</field>
    <field name="res_model">res.partner</field>
    <field name="type">ir.actions.act_window</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="context">{'default_company_type': 'company',}</field>
  </record>
  <menuitem id="menu_contact_cat"
            name="Contacts"
            parent="menu_support_sub"
            action="action_res_partner_cat"
            sequence="50"
            groups="support_group_user"/>


  <record id="support_center_case_view_tree" model="ir.ui.view">
    <field name="name">Support Center Case Type Tree View</field>
    <field name="model">case.type</field>
    <field name="arch" type="xml">
      <tree string="Support case type" editable="bottom" >
        <field name="name"/>
      </tree>
    </field>
  </record>

   <record id="action_support_case" model="ir.actions.act_window">
    <field name="name">Case type</field>
    <field name="res_model">case.type</field>
    <field name="type">ir.actions.act_window</field>
    <field name="view_mode">tree</field>
     </record>

      <menuitem id="menu_support_center_case"
            name="Case Type"
            parent="menu_support_sub"
            action="action_support_case"
            sequence="11"
            groups="support_group_user"/>

</odoo>